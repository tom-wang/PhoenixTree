"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function t(e,n){for(var o=0;o<n.length;o++){var t=n[o];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),_index=require("./npm/@tarojs/taro-weapp/index.js"),_index2=_interopRequireDefault(_index),_index3=require("./npm/@tarojs/redux/index.js"),_index4=require("./store/index.js"),_index5=_interopRequireDefault(_index4),_session=require("./actions/session.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}function _inherits(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}var store=(0,_index5.default)();(0,_index3.setStore)(store);var _App=function(e){function n(){return _classCallCheck(this,n),_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return _inherits(n,_index.Component),_createClass(n,[{key:"componentDidShow",value:function(){var e=this,n=arguments;console.log("onLaunch",arguments),this.login().then(function(){wx.cloud.init(),e.getCurrentUserInfo(),e.getUserRegInfo()}).catch(function(){console.log(n),console.log("catch")})}},{key:"componentDidHide",value:function(){store.dispatch((0,_session.setIndexNeedReload)(!0))}},{key:"getCurrentUserInfo",value:function(){wx.getUserInfo({lang:"zh_CN",withCredentials:!0,success:function(e){store.dispatch((0,_session.setUserInfo)(e.userInfo)),store.dispatch((0,_session.setUserInfoLoading)(!1)),console.log(e)},fail:function(e){store.dispatch((0,_session.setUserInfo)(-1)),store.dispatch((0,_session.setUserInfoLoading)(!1)),console.log(e)}})}},{key:"login",value:function(){return new Promise(function(n,e){wx.checkSession({success:function(){console.log("success"),n()},fail:function(){console.log("fail"),wx.login({success:function(e){console.log(e),n(e),e.code},fail:function(){console.log(arguments),e()}})}})})}},{key:"getUserRegInfo",value:function(){store.dispatch((0,_session.loadRegInfo)())}},{key:"componentCatchError",value:function(){}}]),n}();exports.default=_App,App(require("./npm/@tarojs/taro-weapp/index.js").default.createApp(_App));