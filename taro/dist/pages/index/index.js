"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _dec,_class,_createClass=function(){function o(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,n,t){return n&&o(e.prototype,n),t&&o(e,t),e}}(),_index=require("../../npm/@tarojs/taro-weapp/index.js"),_index2=_interopRequireDefault(_index),_index3=require("../../npm/@tarojs/redux/index.js"),_index4=require("../../components/list/index.js"),_index5=_interopRequireDefault(_index4),_index6=require("../../components/loadmore/index.js"),_index7=_interopRequireDefault(_index6),_index8=require("../../components/tipsComponent/index.js"),_index9=_interopRequireDefault(_index8),_counter=require("../../actions/counter.js"),_session=require("../../actions/session.js"),_const=require("../../utils/const.js"),Const=_interopRequireWildcard(_const),_index10=require("../../utils/index.js");function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[t]=e[t]);return n.default=e,n}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}function _inherits(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}var Index=(_dec=(0,_index3.connect)(function(e){return{counter:e.counter,session:e.session}},function(n){return{add:function(){n((0,_counter.add)())},dec:function(){n((0,_counter.minus)())},asyncAdd:function(){n((0,_counter.asyncAdd)())},setUserInfo:function(e){n((0,_session.setUserInfo)(e))},setUserInfoList:function(e){n((0,_session.setUserInfoList)(e))},laodRegInfo:function(){n((0,_session.loadRegInfo)())}}}))(_class=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.$usedState=["userInfo","msg","userInfoList","regInfo","isLoading","isNotAuth","hasReg","isNotAuthorized","$$TipsComponent","$$TipsComponent_1","$$TipsComponent_2","$$TipsComponent_3","$$List","$$LoadMore"],n.$props={TipsComponent:function(){return{$name:"TipsComponent",userInfo:this.state.userInfo,msg:["“梧桐树下Plus”需要用到你的公开信息","点击授权按钮并同意授权"]}},TipsComponent_1:function(){return{$name:"TipsComponent_1",userInfo:this.state.userInfo,msg:["前世回眸才换来今生相识","快来填写你的信息吧"]}},TipsComponent_2:function(){return{$name:"TipsComponent_2",userInfo:this.state.userInfo,msg:["资料审核中..."]}},TipsComponent_3:function(){return{$name:"TipsComponent_3",userInfo:this.state.userInfo,msg:this.state.msg}},List:function(){return{$name:"List",userInfoList:this.state.userInfoList,regInfo:this.state.regInfo}},LoadMore:function(){return{$name:"LoadMore",isEnd:!0}}},n.$components={TipsComponent:_index9.default,TipsComponent_1:_index9.default,TipsComponent_2:_index9.default,TipsComponent_3:_index9.default,List:_index5.default,LoadMore:_index7.default},n.state=n._createData(),n}return _inherits(t,_index.Component),_createClass(t,[{key:"componentWillMount",value:function(){console.log("onLoad")}},{key:"onShareAppMessage",value:function(){var e=["在这个小程序里找手机号码很方便呢","我的手机号共享在这个小程序里，你也来吧","朋友，有空联系，喝一杯"];return{title:e[Math.floor(Math.random()*e.length)]}}},{key:"componentDidShow",value:function(e){console.log("on show",e),this.fetchUserInfoList()}},{key:"fetchUserInfoList",value:function(){var n=this;return wx.cloud.database().collection("member_info").where({state:Const.REG_STATUS_2,authorized:1}).get().then(function(e){console.log("======",e),n.props.setUserInfoList(e.data)})}},{key:"__event_onGetUserInfo",value:function(e){console.log(e),e.detail.userInfo?this.props.setUserInfo(e.detail.userInfo):(0,_index10.error)("授权失败")}},{key:"__event_onClick",value:function(e){wx.switchTab({url:"/pages/me/index"})}},{key:"_createData",value:function(){this.__state=arguments[0]||this.state||{},this.__props=arguments[1]||this.props||{},console.log("index render");var e=this.__props.session,n=e.userInfo,t=e.regInfo,o=e.userInfoList,s=e.userInfoLoading,r=e.regInfoLoading,i=e.hasReg;Const.REG_STATUS_2!=t.state||o||this.fetchUserInfoList();var a=!(!s&&!r);a?wx.showLoading({title:"拼命加载中..."}):wx.hideLoading();var u=-1===n;u||a?wx.hideTabBar():wx.showTabBar(),u&&(n={avatarUrl:"/static/leaf.png"});var c=t.state!=Const.REG_STATUS_2;return Object.assign(this.__state,{userInfo:n,msg:[],userInfoList:o,regInfo:t,isLoading:a,isNotAuth:u,hasReg:i,isNotAuthorized:c}),this.__state.__data=Object.assign({},this.__state),this.__state}}]),t}())||_class;exports.default=Index,Page(require("../../npm/@tarojs/taro-weapp/index.js").default.createPage(Index,{path:"src/pages/index/index.js"}));